# CLAUDE.md - AI Agent Memory Rules

## #strict-rules
- **NO unsafe code** - Never use `unsafe` blocks anywhere
- **NO std::any::Any** - Avoid runtime type casting
- **NO super** - Explicit trait implementations only
- **NO turbofish** - Use `.with_component(ComponentId)` instead of `::<T>`
- **NO TODOs** - Complete all implementations fully
- **NO incomplete code** - Everything must compile and work
- **NO dyn** - Use concrete types/base classes instead of trait objects
- **NO enums for type erasure** - Use concrete wrapper types instead
- **Handle<T> for external refs** - Use Handle<T> (Arc<T>) for referencing objects with internal state
- **Shared<T> for internal state** - Use Shared<T> (Arc<RwLock<T>>) ONLY for private fields
- **tokio::sync::RwLock ONLY** - NEVER use parking_lot::RwLock (Send issues)
- **NO DashMap** - Use Shared<HashMap> instead
- **Result everywhere** - All fallible operations return Result<T, Error>
- **Async by default** - All I/O must be async
- **Batch operations** - APIs operate on collections, not singles
- **NO dangling imports** - Remove unused imports immediately
- **Async propagates** - If a function uses .await, it must be async
- **Files under 1000 lines** - Split large files into directories
- **lib.rs/mod.rs exports only** - No implementation code in these files
- **Always check memory/architecture/ARCHITECTURE.md** - For complete architecture patterns and VTable system
- **Always check memory/architecture/PATTERNS.md** - For code patterns, examples, and anti-patterns
- **Always check memory/design/DESIGN.md** - For long-term vision, goals, and target architecture
- **Always check memory/design/ROADMAP.md** - For task sequence, milestones, and priorities
- **Always check memory/status/STATUS.md** - For current implementation status by package
- **Always check memory/status/VIOLATIONS.md** - For current violations and fixes needed
- **Always check memory/sessions/CURRENT_SESSION.md** - For active session work and progress
- **Always check memory/sessions/HISTORY.md** - For session index and major accomplishments
- **Always check memory/sessions/CONTEXT.md** - For session continuity and next steps
- **Apps/Plugins use core/* ONLY** - With feature flags, never systems/*
- **Systems/* use core/* ONLY** - They implement the contracts, never import other systems
- **Core/* has data + VTable ONLY** - NO implementation logic, just data fields and delegation
- **NEVER assume architecture** - Read the code as designed
- **Read files fully** - Not partially, for later reference
- **Read before write** - Always read a file before modifying
- **NO migration code** - Never add migration notes, plans, or functions
- **Never search with grep** - Use Read, Glob, or proper tools
- **Check git log for details** - Use `git log --grep="Session XX"` for session history